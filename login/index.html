<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>{{ APPLICATION_NAME }}</title>
	<script type="text/javascript">
	(function() {
		var po = document.createElement('script');
		po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/client:plusone.js?onload=render';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(po, s);
	})();
	
	function render() {
		gapi.signin.render('g-customBtn', {
			'callback': 'onSignInCallback',
			'clientid': '{{ CLIENT_ID }}',
			'cookiepolicy': 'single_host_origin',
			'scope': 'profile'
		});
	}
	</script>
	<style type="text/css">
	#g-customBtn,
	#f-customBtn,
	#t-customBtn {
      display: block;
      color: white;
      width: 100%;
      border-radius: 5px;
      white-space: nowrap;
    }
    #g-customBtn {
      background: #dd4b39;
    }
    #g-customBtn:hover {
      cursor: pointer;
      background: #e8877b;
    }
    #f-customBtn {
      background: #3b5998;
    }
    #f-customBtn:hover {
      cursor: pointer;
      background: #7c90ba;
    }
    #t-customBtn {
      background: #55acee;
    }
    #t-customBtn:hover {
      cursor: not-allowed;
      background: #8ec8f4;
    }
    span.label {
      font-weight: bold;
    }
    span.g-icon {
      background: url('../img/gplus.png') transparent;
      border-right: #933226 1px solid;
    }
    span.f-icon {
	  background: url('../img/transparent-fb.png') transparent;
      border-right: #273b65 1px solid;
    }
    span.t-icon {
	  background: url('../img/t-logo.png') transparent;
      border-right: #39739f 1px solid;
    }
    span.g-icon,
    span.f-icon,
    span.t-icon {
      display: inline-block;
      vertical-align: middle;
      background-size: 35px 35px;
      width: 35px;
      height: 35px;
    }
    span.buttonText {
      display: inline-block;
      vertical-align: middle;
      padding-left: 35px;
      padding-right: 35px;
    }
	</style>
	<link href="//ifantasyfitness.com/css/main.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	<link href="//ifantasyfitness.com/css/bootstrap-datetimepicker.css" rel="stylesheet">
</head>
<body>
	<div class="navbar navbar-default" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">iFantasyFitness</a>
			</div>
			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li><a href="/">Home</a></li>
					<li><a href="/leaderboard">Leaderboard</a></li>
					<li><a href="/rules">Rules</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="/login">Sign in</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<h2>Sign in</h2>
				<p>Please choose a social network to sign in with. You can add and remove more from your account settings at any time.</p>
				<p><strong>Please don't test things out yet</strong> as most of the sign-in stuff is being updated.</p>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-4">
				<div id="gSignInWrapper">
					<div id="g-customBtn" class="customGPlusSignIn">
						<span class="g-icon"></span>
						<span class="buttonText">Sign in with Google</span>
					</div>
				</div>
			</div>
			<div class="col-sm-4">
				<div id="f-customBtn">
					<span class="f-icon"></span>
					<span class="buttonText">Sign in with Facebook</span>
				</div>
			</div>
			<div class="col-sm-4">
				<div id="t-customBtn">
					<span class="t-icon"></span>
					<span class="buttonText">Sign in with Twitter</span>
				</div>
			</div>
		</div>
	</div>
	<hr>
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<p class="lead">iFantasyFitness: Train Competitively</p>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<p>iFantasyFitness is Highland Park Cross Country's way of summer training. By training competitively, the team gets stronger.</p>
				<ul class="list-inline">
					<li><a href="/about">About</a>
					<li><a href="/leaderboard">Leaderboard</a></li>
					<li><a href="/rules">Competition Rules</a></li>
					<li><a href="https://twitter.com/ifantasyfitness">Twitter</a></li>
					<li><a href="http://www.dreamhost.com/donate.cgi?id=17581">Support Us</a></li>
					<li><a href="http://blog.ifantasyfitness.com">Blog</a></li>
					<li><a href="https://github.com/ichiefboz/ifantasyfitness"><i class="fa fa-github"></i> Source Code</a></li>
					<li><a href="/privacy">Privacy</a></li>
					<li><a href="/tos">Terms</a></li>
				</ul>
				<p>Copyright &copy; Highland Park Cross Country 2012-{{ "now"|date("Y") }}<span class="pull-right">DFTBA</span></p>
			</div>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script src="//ifantasyfitness.com/js/moment.min.js"></script>
	<script src="//ifantasyfitness.com/js/dates.min.js"></script>
</body>
<script type="text/javascript">
var helper = (function() {
  var authResult = undefined;

  return {
    /**
     * Hides the sign-in button and connects the server-side app after
     * the user successfully signs in.
     *
     * @param {Object} authResult An Object which contains the access token and
     *   other authentication information.
     */
    onSignInCallback: function(authResult) {
      $('#authResult').html('Auth Result:<br/>');
      for (var field in authResult) {
        $('#authResult').append(' ' + field + ': ' + authResult[field] + '<br/>');
      }
      if (authResult['access_token']) {
        // The user is signed in
        this.authResult = authResult;
        helper.connectServer();
        // After we load the Google+ API, render the profile data from Google+.
        gapi.client.load('plus','v1',this.renderProfile);
      }
    },
    /**
     * Retrieves and renders the authenticated user's Google+ profile.
     */
    renderProfile: function() {
      var request = gapi.client.plus.people.get( {'userId' : 'me'} );
      request.execute( function(profile) {
	      // window.location.href = "http://www.ifantasyfitness.com/setup?provider=google&uid=" + profile.id + "&first=" + profile.name.givenName + "&last=" + profile.name.familyName;
      });
    },
    /**
     * Calls the server endpoint to disconnect the app for the user.
     */
    disconnectServer: function() {
      // Revoke the server tokens
      $.ajax({
        type: 'POST',
        url: window.location.href + 'signin.php/disconnect',
        async: false,
        success: function(result) {
          console.log('revoke response: ' + result);
          $('#authOps').hide();
          $('#profile').empty();
          $('#visiblePeople').empty();
          $('#authResult').empty();
          $('#gConnect').show();
        },
        error: function(e) {
          console.log(e);
        }
      });
    },
    /**
     * Calls the server endpoint to connect the app for the user. The client
     * sends the one-time authorization code to the server and the server
     * exchanges the code for its own tokens to use for offline API access.
     * For more information, see:
     *   https://developers.google.com/+/web/signin/server-side-flow
     */
    connectServer: function() {
      console.log(this.authResult.code);
      $.ajax({
        type: 'POST',
        url: window.location.href + 'signin.php/connect?state={{ STATE }}',
        contentType: 'application/octet-stream; charset=utf-8',
        processData: false,
        data: this.authResult.code
      });
    },
  };
})();

/**
 * Perform jQuery initialization and check to ensure that you updated your
 * client ID.
 */
$(document).ready(function() {
  $('#disconnect').click(helper.disconnectServer);
  if ($('[data-clientid="YOUR_CLIENT_ID"]').length > 0) {
    alert('This sample requires your OAuth credentials (client ID) ' +
        'from the Google APIs console:\n' +
        '    https://code.google.com/apis/console/#:access\n\n' +
        'Find and replace YOUR_CLIENT_ID with your client ID and ' +
        'YOUR_CLIENT_SECRET with your client secret in the project sources.'
    );
  }
});

/**
 * Calls the helper method that handles the authentication flow.
 *
 * @param {Object} authResult An Object which contains the access token and
 *   other authentication information.
 */
function onSignInCallback(authResult) {
  helper.onSignInCallback(authResult);
}
</script>
</html>
